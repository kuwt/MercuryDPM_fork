# Template C++ Application

# This template allows you to validate your C++ application.
# The workflow allows running tests and code linting on the default branch.


image:
  name: plath/mercurydpm@sha256:d2ef7bf5336d82abd1540dc1d2cc0182c2e77573888f83486e19346010652db7

pipelines:
  default:
      - step:
          name: Test
          script:
            - mkdir MercuryBuild
            - cd MercuryBuild
            - cmake -DCMAKE_BUILD_TYPE=Debug -G 'CodeBlocks - Unix Makefiles' ../
          artifacts:
            - error_log.txt
          after-script:
            - make fullTest
            - pipe: atlassian/slack-notify:2.0.0
              variables:
                WEBHOOK_URL: 'https://hooks.slack.com/services/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'
                PRETEXT: 'Checking commit; make fullTest running for $BITBUCKET_REPO_SLUG, branch: $BITBUCKET_BRANCH'
                MESSAGE: '"[${ENVIRONMENT_NAME}] build has exited with status $build_status; $([[ -s error_log.txt ]] && cat error_log.txt || echo All tests passed!)"'
                DEBUG: 'true'